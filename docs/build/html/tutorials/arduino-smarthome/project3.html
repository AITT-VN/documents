

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Project 3: Đèn thông minh &mdash; OhStem Product Documents 0.0.2 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo-ohstem.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">xController</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../board/introduction.html">Giới thiệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../board/hardware.html">Phần cứng</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../board/drive.html">Cài đặt Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../board/app.html">Phần mềm lập trình</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../board/flashburn.html">Cập nhật Firmware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/micropython-api/index.html">MicroPython API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/arduino-api/index.html">Arduino API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">xBuild Creator Kit</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../micropython/index.html">Hướng dẫn lập trình MicroPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arduino/index.html">Hướng dẫn lập trình Arduino</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Yolo:Bit</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../yolobit/introduction.html">Giới thiệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../yolobit/hardware.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../yolobit/drive.html">Driver download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../yolobit/flashburn.html">Cập nhật Firmware</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Phần mềm Ohstem App</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../app/introduction.html">Giới thiệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app/install.html">Cài đặt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app/frontend.html">Giao diện</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app/connect.html">Kết nối</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app/runandsave.html">Chạy và lưu project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app/createnew.html">Tạo một mục mở rộng mới</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../app/blockapi.html">Block API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OhStem Product Documents</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Project 3: Đèn thông minh</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/username/reponame/blob/mastertutorials/arduino-smarthome/project3.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="project-3-den-thong-minh">
<h1>Project 3: Đèn thông minh<a class="headerlink" href="#project-3-den-thong-minh" title="Permalink to this headline">¶</a></h1>
<div class="section" id="muc-tieu">
<h2>Mục tiêu<a class="headerlink" href="#muc-tieu" title="Permalink to this headline">¶</a></h2>
<p>Trong một ngôi nhà, nếu đèn có thể tự bật một cách thông minh khi có người hoặc khi trời bắt đầu tối thì sẽ rất thuận tiện đấy. Một số ví dụ phổ biến là đèn ngoài cửa khi ta đi về nhà hoặc đèn cầu thang khi ta đi lên xuống buổi tối.</p>
<p>Trong bài này, chúng ta cùng nhau làm một đèn ngoài cửa nhà thông minh với các tính năng sau:</p>
<blockquote>
<div><ul class="simple">
<li><p>Tự động bật đèn khi phát hiện chuyển động hoặc khi trời đang tối</p></li>
<li><p>Tự động tắt sau 15 giây</p></li>
</ul>
</div></blockquote>
<p>Để phát hiện được có người, chúng ta sẽ dùng một cảm biến mới là cảm biến phát hiện chuyển động bằng hồng ngoại (<code class="docutils literal notranslate"><span class="pre">Passive</span> <span class="pre">Infrared</span></code>, gọi tắt là <code class="docutils literal notranslate"><span class="pre">PIR</span></code>).</p>
<a class="reference internal image-reference" href="../../_images/project-3-1.png"><img alt="../../_images/project-3-1.png" class="align-center" src="../../_images/project-3-1.png" style="width: 320px;" /></a>
<p>Khi phát hiện có chuyển động, chân tín hiệu của module sẽ được bật ở mức <code class="docutils literal notranslate"><span class="pre">HIGH</span></code>. Bình thường, chân tín hiệu này sẽ ở mức <code class="docutils literal notranslate"><span class="pre">LOW</span></code>.</p>
</div>
<div class="section" id="thiet-bi-can-su-dung">
<h2>Thiết bị cần sử dụng<a class="headerlink" href="#thiet-bi-can-su-dung" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="../../_images/project-3-2.png"><img alt="../../_images/project-3-2.png" class="align-center" src="../../_images/project-3-2.png" style="width: 600px;" /></a>
</div>
<div class="section" id="ket-noi-phan-cung">
<h2>Kết nối phần cứng<a class="headerlink" href="#ket-noi-phan-cung" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="../../_images/project-3-3.png"><img alt="../../_images/project-3-3.png" class="align-center" src="../../_images/project-3-3.png" style="width: 600px;" /></a>
</div>
<div class="section" id="viet-chuong-trinh">
<h2>Viết chương trình<a class="headerlink" href="#viet-chuong-trinh" title="Permalink to this headline">¶</a></h2>
<p>Mở phần mềm Arduino IDE.</p>
<p>Copy đoạn code sau, click vào nút <code class="docutils literal notranslate"><span class="pre">Verify</span></code> để kiểm tra lỗi chương trình. Sau khi biên dịch không báo lỗi, bạn có thể nạp đoạn code vào board.</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>#<span class="nv">define</span> <span class="nv">LIGHT_PIN</span> <span class="nv">A4_1</span>
#<span class="nv">define</span> <span class="nv">PIR_PIN</span> <span class="nv">D5_1</span>
#<span class="nv">define</span> <span class="nv">LED_PIN</span> <span class="nv">D6_1</span>

<span class="nv">int</span> <span class="nv">lightSensorValue</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">;</span>
<span class="nv">int</span> <span class="nv">pirState</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">;</span>
<span class="nv">int</span> <span class="nv">LEDState</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">;</span>

<span class="nv">unsigned</span> <span class="nv">long</span> <span class="nv">LEDOnTime</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">; // lưu thời gian lúc bật đèn</span>

<span class="nv">void</span> <span class="nv">setup</span><span class="ss">()</span> {
  <span class="nv">pinMode</span><span class="ss">(</span><span class="nv">LED_PIN</span>, <span class="nv">OUTPUT</span><span class="ss">)</span><span class="c1">;</span>
  <span class="nv">pinMode</span><span class="ss">(</span><span class="nv">PIR_PIN</span>, <span class="nv">INPUT</span><span class="ss">)</span><span class="c1">;</span>
}

<span class="nv">void</span> <span class="k">loop</span><span class="ss">()</span> {
  <span class="o">//</span> đọ<span class="nv">c</span> <span class="nv">gi</span>á <span class="nv">tr</span>ị <span class="nv">c</span>ả<span class="nv">m</span> <span class="nv">bi</span>ế<span class="nv">n</span> á<span class="nv">nh</span> <span class="nv">s</span>á<span class="nv">ng</span>
  <span class="nv">lightSensorValue</span> <span class="o">=</span> <span class="nv">analogRead</span><span class="ss">(</span><span class="nv">LIGHT_PIN</span><span class="ss">)</span><span class="c1">;</span>
  <span class="nv">pirState</span> <span class="o">=</span> <span class="nv">digitalRead</span><span class="ss">(</span><span class="nv">PIR_PIN</span><span class="ss">)</span><span class="c1">;</span>
  <span class="k">if</span> <span class="ss">(</span><span class="nv">pirState</span> <span class="o">==</span> <span class="nv">HIGH</span> <span class="o">&amp;&amp;</span> <span class="nv">lightSensorValue</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="ss">)</span> {
    <span class="o">//</span> <span class="nv">tr</span>ờ<span class="nv">i</span> <span class="nv">t</span>ố<span class="nv">i</span> <span class="nv">v</span>à <span class="nv">ph</span>á<span class="nv">t</span> <span class="nv">hi</span>ệ<span class="nv">n</span> <span class="nv">c</span>ó <span class="nv">ng</span>ườ<span class="nv">i</span> <span class="o">=&gt;</span> <span class="nv">b</span>ậ<span class="nv">t</span> đè<span class="nv">n</span>
    <span class="nv">digitalWrite</span><span class="ss">(</span><span class="nv">LED_PIN</span>, <span class="nv">HIGH</span><span class="ss">)</span><span class="c1">;</span>
    <span class="nv">LEDOnTime</span> <span class="o">=</span> <span class="nv">millis</span><span class="ss">()</span><span class="c1">;</span>
    <span class="nv">LEDState</span> <span class="o">=</span> <span class="mi">1</span><span class="c1">;</span>
  }

  <span class="o">//</span> <span class="nv">l</span>ấ<span class="nv">y</span> <span class="nv">th</span>ờ<span class="nv">i</span> <span class="nv">gian</span> <span class="nv">hi</span>ệ<span class="nv">n</span> <span class="nv">t</span>ạ<span class="nv">i</span>
  <span class="nv">unsigned</span> <span class="nv">long</span> <span class="nv">currentMillis</span> <span class="o">=</span> <span class="nv">millis</span><span class="ss">()</span><span class="c1">;</span>
  <span class="k">if</span> <span class="ss">(</span><span class="nv">LEDState</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">currentMillis</span> <span class="o">-</span> <span class="nv">LEDOnTime</span> <span class="o">&gt;=</span> <span class="mi">10000</span><span class="ss">)</span> {
    <span class="o">//</span> đã <span class="nv">b</span>ậ<span class="nv">t</span> đè<span class="nv">n</span> đượ<span class="nv">c</span> <span class="nv">qu</span>á <span class="mi">15</span><span class="nv">s</span> <span class="o">=&gt;</span> <span class="nv">t</span>ắ<span class="nv">t</span> đè<span class="nv">n</span>
    <span class="nv">digitalWrite</span><span class="ss">(</span><span class="nv">LED_PIN</span>, <span class="nv">LOW</span><span class="ss">)</span><span class="c1">;</span>
    <span class="nv">LEDOnTime</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">;</span>
    <span class="nv">LEDState</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">;</span>
  }
}
</pre></div>
</div>
</div>
<div class="section" id="giai-thich-chuong-trinh">
<h2>Giải thích chương trình<a class="headerlink" href="#giai-thich-chuong-trinh" title="Permalink to this headline">¶</a></h2>
<p>Trong chương trình trên, chúng ta sẽ sử dụng các hàm đơn giản đã học là <code class="docutils literal notranslate"><span class="pre">digitalRead()</span></code> để đọc tín hiệu Digital từ cảm biến PIR và hàm <code class="docutils literal notranslate"><span class="pre">analogRead()</span></code> để đọc giá trị cảm biến ánh sáng. Sau đó, chương trình kiểm tra điều kiện có phát hiện sự chuyển động và trời có đang tối không để bật đèn.</p>
<p>Sau khi bật đèn, chúng ta sử dụng cách thức đo thời gian như trong project 2 để biết đến lúc phải tắt đèn (sau 10 giây tính từ lúc bật đèn).</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, OHSTEM.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>