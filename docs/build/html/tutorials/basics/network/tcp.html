

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>10.3. Socket - TCP &mdash; OhStem Product Documents 0.0.2 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="10.4. Socket - UDP" href="udp.html" />
    <link rel="prev" title="10.2. Introduction to TCP/IP" href="tcpip.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/logo-ohstem.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../board/index.html">xController Board</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">xController Micropython Tutorial</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Basic Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../repl.html">1. REPL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oled.html">2. Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="../neopixel.html">3. RGB LED</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buzz.html">4. Music</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buttons.html">5. Key Button</a></li>
<li class="toctree-l2"><a class="reference internal" href="../touchpad.html">6. Touchpad</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound.html">7. Microphone</a></li>
<li class="toctree-l2"><a class="reference internal" href="../light.html">8. Light Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accelerometer.html">9. Accelerometer</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">10. Network</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="network_basics.html">10.1. Network Basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="tcpip.html">10.2. Introduction to TCP/IP</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">10.3. Socket - TCP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-is-socket">10.3.1. What is socket?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#introduction-to-tcp-protocol">10.3.2. Introduction to TCP protocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tcp-programming">10.3.3. TCP programming</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="udp.html">10.4. Socket - UDP</a></li>
<li class="toctree-l3"><a class="reference internal" href="http.html">10.5. HTTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="parsing_json.html">10.6. Parsing JSON</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../uart.html">11. Serial Port</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/index.html">12. Pins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../advance/index.html">Advance Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">xController Arduino Tutorial</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Basic Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../repl.html">1. REPL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oled.html">2. Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="../neopixel.html">3. RGB LED</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buzz.html">4. Music</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buttons.html">5. Key Button</a></li>
<li class="toctree-l2"><a class="reference internal" href="../touchpad.html">6. Touchpad</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound.html">7. Microphone</a></li>
<li class="toctree-l2"><a class="reference internal" href="../light.html">8. Light Sensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accelerometer.html">9. Accelerometer</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">10. Network</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="network_basics.html">10.1. Network Basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="tcpip.html">10.2. Introduction to TCP/IP</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">10.3. Socket - TCP</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-is-socket">10.3.1. What is socket?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#introduction-to-tcp-protocol">10.3.2. Introduction to TCP protocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tcp-programming">10.3.3. TCP programming</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="udp.html">10.4. Socket - UDP</a></li>
<li class="toctree-l3"><a class="reference internal" href="http.html">10.5. HTTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="parsing_json.html">10.6. Parsing JSON</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../uart.html">11. Serial Port</a></li>
<li class="toctree-l2"><a class="reference internal" href="../io/index.html">12. Pins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../advance/index.html">Advance Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">xController Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../library/micropython-api/index.html">MicroPython Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../library/arduino-api/index.html">Arduino Library</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">OhStem Product Documents</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Basic Tutorials</a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">10. </span>Network</a> &raquo;</li>
        
      <li><span class="section-number">10.3. </span>Socket - TCP</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/username/reponame/blob/mastertutorials/basics/network/tcp.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="socket-tcp">
<h1><span class="section-number">10.3. </span>Socket - TCP<a class="headerlink" href="#socket-tcp" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-socket">
<h2><span class="section-number">10.3.1. </span>What is socket?<a class="headerlink" href="#what-is-socket" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Socket</span></code> is an abstract concept of network programming. Usually we use a Socket to mean “opened a network line”, and open a Socket need to know the IP address and port number of the target computer, and then specify the protocol type.</p>
</div>
<div class="section" id="introduction-to-tcp-protocol">
<h2><span class="section-number">10.3.2. </span>Introduction to TCP protocol<a class="headerlink" href="#introduction-to-tcp-protocol" title="Permalink to this headline">¶</a></h2>
<p>TCP protocol, Transmission Control Protocol (Transmission Control Protocol, abbreviated as TCP) is a connection-oriented, reliable, byte stream-based transport layer communication protocol, defined by IETF RFC 793.</p>
<p>TCP communication needs to go through three steps: creating a connection, data transmission, and terminating the connection. In the TCP communication model, before communication starts, you must first create a relevant connection before sending data, similar to “calling”” in daily routine。</p>
<p>When the socket is working, the two sides of the connection are divided into server and client, that is, C / S mode, and the TCP communication principle is as follows:</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../images/tutorials/tcpprinciple.png"><img alt="../images/tutorials/tcpprinciple.png" src="../images/tutorials/tcpprinciple.png" /></a>
<p class="caption"><span class="caption-text">Socket TCP communication process</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="tcp-programming">
<h2><span class="section-number">10.3.3. </span>TCP programming<a class="headerlink" href="#tcp-programming" title="Permalink to this headline">¶</a></h2>
<p>This part of the tutorial will show how to use TCP sockets as a client or server. For more comprehensive use of the socket module, please refer to <code class="xref py py-mod docutils literal notranslate"><span class="pre">usocket</span></code> module.
The following tutorials need to use TCP network debugging tools. The following is the  <strong>Network Test Utility</strong> of IOS，You can search and install in the APP Store, please click to download the android system 。 <code class="xref download docutils literal notranslate"><span class="pre">Network</span> <span class="pre">Test</span> <span class="pre">Utility.apk</span></code></p>
<p>Announcement: The TCP client （tcpClient）here is your computer or mobile phone, and the TCP server （tcpServer）is the mPython Board.</p>
<div class="section" id="tcp-client">
<h3><span class="section-number">10.3.3.1. </span>TCP client<a class="headerlink" href="#tcp-client" title="Permalink to this headline">¶</a></h3>
<p>The general steps of TCP programming client are：</p>
<ol class="arabic simple">
<li><p>Create a socket, use function socket()</p></li>
<li><p>To set the socket property, use the functions setsockopt() , <em>optional</em></p></li>
<li><p>Bind the IP address, port and other information to the socket, use the function bind() , <em>optional</em></p></li>
<li><p>Set the IP address and port of the other party to be connected</p></li>
<li><p>To connect to the server, use the function connect()</p></li>
<li><p>To send and receive data, use the functions send() and recv(), or read() and write()</p></li>
<li><p>Close network connection</p></li>
</ol>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Since they are transmitted in bytes on the network, you need to pay attention to data encoding and decoding.</p>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>In the above example, use <code class="docutils literal notranslate"><span class="pre">connectWiFi()</span></code> to connect to the same router wifi. You can also use <code class="docutils literal notranslate"><span class="pre">enable_APWiFi()</span></code> to turn on the AP mode and build a wifi network to allow other devices to access it.</p>
</div>
<p>First, the mPython Board and mobile phone must be connected to the same local area network. OPen Network Test Utility，Enter the “TCP Server” interface.
TCP Server IP selects the IP address of the mobile phone in the network, and the port number can be set from 0 to 65535. Then, click Listen to start listening on the port.
Set the TCP server IP address  <code class="docutils literal notranslate"><span class="pre">host</span></code> and port number <code class="docutils literal notranslate"><span class="pre">port</span></code> selected above in the program, restart the program。</p>
<p>When the connection to the Server is successful, the TCP Server will receive the text <code class="docutils literal notranslate"><span class="pre">hello</span> <span class="pre">mPython,I</span> <span class="pre">am</span> <span class="pre">TCP</span> <span class="pre">Client</span></code> sent by the Client. At this point, you send text to the Client in the TCP Server, the control panel will
receive text and display the text on the OLED screen.</p>
<img alt="../images/tutorials/socket_1.gif" src="../images/tutorials/socket_1.gif" />
</div>
<div class="section" id="tcp-server">
<h3><span class="section-number">10.3.3.2. </span>TCP server<a class="headerlink" href="#tcp-server" title="Permalink to this headline">¶</a></h3>
<p>The general steps of the TCP programming server are：</p>
<ol class="arabic simple">
<li><p>Create a socket, use function socket()</p></li>
<li><p>To set the socket attribute, use the functions setsockopt() , <em>optional</em></p></li>
<li><p>Bind the IP address, port and other information to the socket, use the function bind()</p></li>
<li><p>Turn on monitoring and set the maximum monitoring number, use the function listen()</p></li>
<li><p>Wait for the client to request a connection, use the function accept()</p></li>
<li><p>To send and receive data, use the functions send() and recv()，or read() and write()</p></li>
<li><p>Close network connection</p></li>
</ol>
<p>tcpServer example:</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>In the above example, use <code class="docutils literal notranslate"><span class="pre">connectWiFi()</span></code> to connect to the same router WiFi. You can also use ` <code class="docutils literal notranslate"><span class="pre">enable_APWiFi()</span></code> to turn on the AP mode and build a wifi network to allow other devices to access it.</p>
</div>
<p>First, the mPython Board and mobile phone must be connected to the same local area network. The control panel restarts the running program, and the TCP Server end waits for the Client connection request. Open the Network Test Utility, enter the “TCP Client”  interface, fill in the Remote host and port, namely <code class="docutils literal notranslate"><span class="pre">socket.blind(ip,port)</span></code>
IP address and port. After the Connect is successfully connected, send text, and the control panel receives the text and displays it on the oled screen and returns it to the TCP Client. You can see the text from Client-&gt;Server，Server-&gt;Client in the receiving interface of the mobile phone.</p>
<a class="reference internal image-reference" href="../images/tutorials/socket_2.gif"><img alt="../images/tutorials/socket_2.gif" class="align-center" src="../images/tutorials/socket_2.gif" /></a>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="udp.html" class="btn btn-neutral float-right" title="10.4. Socket - UDP" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="tcpip.html" class="btn btn-neutral float-left" title="10.2. Introduction to TCP/IP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, OHSTEM.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>