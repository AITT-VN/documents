

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>2. Storage &mdash; OhStem Product Documents 0.0.2 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3. Timer" href="timer.html" />
    <link rel="prev" title="1. Random Number" href="random.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo-ohstem.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../board/index.html">xController Board</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">xController Micropython Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">Basic Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advance Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="random.html">1. Random Number</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2. Storage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#open-a-file">2.1. Open a file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#os">2.2. OS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#main-program-main-py">2.3. Main program main.py</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="timer.html">3. Timer</a></li>
<li class="toctree-l2"><a class="reference internal" href="radio.html">4. Radio Broadcast</a></li>
<li class="toctree-l2"><a class="reference internal" href="i2c.html">5. I2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread.html">6. Thread</a></li>
<li class="toctree-l2"><a class="reference internal" href="bme280.html">7. BME280</a></li>
<li class="toctree-l2"><a class="reference internal" href="iot/index.html">8. Internet of Things</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">xController Arduino Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">Basic Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advance Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="random.html">1. Random Number</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2. Storage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#open-a-file">2.1. Open a file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#os">2.2. OS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#main-program-main-py">2.3. Main program main.py</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="timer.html">3. Timer</a></li>
<li class="toctree-l2"><a class="reference internal" href="radio.html">4. Radio Broadcast</a></li>
<li class="toctree-l2"><a class="reference internal" href="i2c.html">5. I2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread.html">6. Thread</a></li>
<li class="toctree-l2"><a class="reference internal" href="bme280.html">7. BME280</a></li>
<li class="toctree-l2"><a class="reference internal" href="iot/index.html">8. Internet of Things</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">xController Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../library/micropython-api/index.html">MicroPython Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../library/arduino-api/index.html">Arduino Library</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OhStem Product Documents</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Advance Tutorials</a> &raquo;</li>
        
      <li><span class="section-number">2. </span>Storage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/username/reponame/blob/mastertutorials/advance/filesystem.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="storage">
<h1><span class="section-number">2. </span>Storage<a class="headerlink" href="#storage" title="Permalink to this headline">¶</a></h1>
<p>Sometimes you need to store useful information. This information is stored as data: a representation of the information (in digital form when stored on a computer).
If you store data on your computer, even if you turn the device off and on again, it should.</p>
<p>The MicroPython bit allows you to do this using a very simple file system.</p>
<p>What is a file system?</p>
<p>It’s a way to store and organize data in a persistent way - any data stored in the file system should continue to exist after the device restarts.
As the name implies, data stored in the file system is organized into files.</p>
<img alt="../images/tutorials/files.jpg" src="../images/tutorials/files.jpg" />
<p>Computer files are named digital resources stored on the file system. These resources contain useful information as data.
This is how paper documents work. It is a named container that contains useful information. Usually, both paper and digital files are named to indicate what they contain。
On a computer, the file ends with the suffix  <code class="docutils literal notranslate"><span class="pre">.xxx</span></code> . Generally, it indicates what type of data is used to represent information.
For example, <code class="docutils literal notranslate"><span class="pre">.txt</span></code> means a text file, `` .jpg`` JPEG image and  <code class="docutils literal notranslate"><span class="pre">.mp3</span></code> sound data encoded as MP3.</p>
<p>Some file systems (such as those on laptops or PCs) allow you to organize files into directories：Named containers combine related files and subdirectories.
However, the file system provided by MicroPython is a flat file system. Flat file systems have no directories - all files are only stored in the same place.</p>
<p>The Python programming language contains an easy-to-use and powerful way to use the computer’s file system. MicroPython on mPython implements a useful subset of these functions, Make it easy to read and write files on the device, while also providing consistency with other Python versions.</p>
<div class="section" id="open-a-file">
<h2><span class="section-number">2.1. </span>Open a file<a class="headerlink" href="#open-a-file" title="Permalink to this headline">¶</a></h2>
<p>The following are the relevant instructions for Python File operation.</p>
<p>open() method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#open(Path + file name, read-write mode) ，like f=open(&#39;/tmp/hello&#39;,&#39;w&#39;)
#Read-write mode:r read only，r+ read-write，w new (will overwrite the original file), a append, b binary file. Such as:&#39;rb&#39;,&#39;wb&#39;,&#39;r+b&#39;, etc
The types of read and write modes are：
rU or Ua opens in read mode, and provides universal newline support (PEP 278)
w     Open in write mode，
a     Open in append mode (starting with EOF, creating new files if necessary)
r+     Open in read-write mode
w+     Open in read-write mode (see w )
a+     Open in read-write mode (see a )
rb     Open in binary read mode
wb     Open in binary write mode (see w )
ab     Open in binary append mode (see a )
rb+    Open in binary read-write mode (see r+ )
wb+    Open in binary read-write mode (see w+ )
ab+    Open in binary read-write mode (see a+ )
</pre></div>
</div>
<p>The file object is created using the open function. The following table lists commonly used functions of the file object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">([</span><span class="n">size</span><span class="p">])</span> <span class="c1"># size if not specified, the entire file is returned, There is a problem if the file size is&gt; 2 times the memory. f.read() return &quot;&quot; (empty string) when reading to the end of the file.</span>
<span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="c1"># return a row</span>
<span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">([</span><span class="n">size</span><span class="p">])</span> <span class="c1">#size Return all rows if not specified</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span> <span class="nb">print</span> <span class="n">line</span> <span class="c1">#access via iterator</span>
<span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;hello</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1">#If you want to write data other than a string, first convert it to a string.</span>
<span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="c1">#Returns an integer representing the position of the current file pointer (that is, the number of bytes to the file header).</span>
<span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="p">[</span><span class="n">start</span> <span class="n">point</span><span class="p">])</span>  <span class="c1">#用To move the file pointer, offset: unit: byte, can be positive or negative, starting position: 0 - file header, default value; 1 - current position; 2 - end of file.</span>
<span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1">#close file</span>
</pre></div>
</div>
<p>Details for use of open(), refers to <span class="xref std std-term">CPython</span> document:<a class="reference external" href="https://docs.python.org/3.5/library/functions.html#open">open()</a>。</p>
<hr class="docutils" />
<p>Open the <code class="docutils literal notranslate"><span class="pre">open</span></code>  function to read and write files on the file system. After opening the file, you can use it until you close it (similar to how we use paper files).</p>
<p>The best way to ensure this is to use the following with statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;story.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">my_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">with</span></code> statement uses the <code class="docutils literal notranslate"><span class="pre">open</span></code>  function to open the file and assign it to the object. In the above example, the <code class="docutils literal notranslate"><span class="pre">open</span></code> function opens the called file <code class="docutils literal notranslate"><span class="pre">story.txt</span></code> (apparently a text file containing a story.
Call the object <code class="docutils literal notranslate"><span class="pre">my_file</span></code> used to represent the file in the Python code。
Then, in the indented code block below the  <code class="docutils literal notranslate"><span class="pre">with</span></code> statement, the <code class="docutils literal notranslate"><span class="pre">my_file</span></code> object is used for the content of the <code class="docutils literal notranslate"><span class="pre">read()</span></code> file and assigns it to the <code class="docutils literal notranslate"><span class="pre">content</span></code> object.</p>
<p>This is an important point, the next line containing the <code class="docutils literal notranslate"><span class="pre">print</span></code> statement is not indented. The code block associated with the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement is just a single line of reading the file.
Once the code block associated with the <code class="docutils literal notranslate"><span class="pre">with</span></code> statement is closed, Python (and MicroPython) will automatically close the file for you.
This is called context processing, and the object created by the <code class="docutils literal notranslate"><span class="pre">open</span></code> function is the file’s context handler.</p>
<p>In short, the scope of interaction with the file is defined by the code block associated with he statement with the file opened.</p>
<p>Confused？</p>
<p>Don’t. I just said your code should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;some_file&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">some_object</span><span class="p">:</span>
    <span class="c1"># Read and write files in this code block</span>

<span class="c1"># When the block is complete, then use MicroPython</span>
<span class="c1"># File closed automatically.</span>
</pre></div>
</div>
<p>Just like paper files, there are two reasons to open files：Read its content (as shown above) or write content to a file。
The default mode is to read files. If you want to write to a file, you need to <code class="docutils literal notranslate"><span class="pre">open</span></code> to tell the function as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;hello.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_file</span><span class="p">:</span>
    <span class="n">my_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hello, World!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note, the <code class="docutils literal notranslate"><span class="pre">'w'</span></code> parameter is used to set the <code class="docutils literal notranslate"><span class="pre">my_file</span></code> object to write mode.
You can also transmit a  <code class="docutils literal notranslate"><span class="pre">'r'</span></code> parameter to set the file object to read mode, but since this is the default setting, it is usually kept.</p>
<p>Writing data to a file is done through (you guessed it) the <code class="docutils literal notranslate"><span class="pre">write</span></code> method, which takes the string you want to write to the file as a parameter.
In the above example, I wrote the text “Hello，World！” Into a file named “hello.txt” .</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>When you open a file and write (maybe multiple times while the file is open), if the file already exists, you will write the file content.</p></li>
<li><p>If you want to append data to a file, you should first read it, store the content somewhere, close it, append the data to the content, and then open it to write again with the modified content。</p></li>
</ul>
</div>
</div>
<div class="section" id="os">
<h2><span class="section-number">2.2. </span>OS<a class="headerlink" href="#os" title="Permalink to this headline">¶</a></h2>
<p>In addition to reading and writing files, Python can also manipulate them. Of course you need to know the files in the file system, sometimes you may also need to delete them.</p>
<p>On regular computers, the role of the operating system (such as Windows, OSX or Linux) is to manage it on behalf of Python.
Python provides such a function through a module called OS.
Since MicroPython is the operating system, we decided to maintain proper functionality in the OS module to maintain consistency, so that when you use “regular” Python on devices such as laptops or Raspberry Pi, you will know where to find them.</p>
<p>Basically, you can perform three operations related to the file system：List files, delete files and enquiry for file size。</p>
<p>To list files on the file system, use the listdir function. It returns a list of strings indicating the file name of the file on the file system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">my_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span>
</pre></div>
</div>
<p>To delete files, use the remove function. It needs a string to represent the file name of the file to be deleted as a parameter, as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;filename.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>os commonly used method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>          <span class="c1">#Modify the path</span>
<span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>             <span class="c1">#Get current path</span>
<span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>         <span class="c1">#Directory listing</span>
<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>           <span class="c1">#Create a directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>         <span class="c1">#Delete Files</span>
<span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>           <span class="c1">#Delete directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">old_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>   <span class="c1">#File rename</span>
<span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>           <span class="c1">#File / directory status, explained below：</span>
</pre></div>
</div>
<p>For more OS module application，see <code class="xref py py-mod docutils literal notranslate"><span class="pre">os</span></code> module chapter.</p>
</div>
<div class="section" id="main-program-main-py">
<h2><span class="section-number">2.3. </span>Main program main.py<a class="headerlink" href="#main-program-main-py" title="Permalink to this headline">¶</a></h2>
<p>boot.py and main.py, these two files are specially processed by MicroPython at startup. First execute the boot.py script (if it exists), and then execute the main.py script.</p>
<p>In addition, if you copy other Python files to the file system, then import is like any other Python module.
For example, if you have a  <code class="docutils literal notranslate"><span class="pre">hello.py</span></code>  file containing the following simple code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;World&quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;Hello, </span><span class="si">{}</span><span class="s2">!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>You can import and use such <code class="docutils literal notranslate"><span class="pre">say_hello</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpython</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">hello</span> <span class="kn">import</span> <span class="n">say_hello</span>

<span class="n">oled</span><span class="o">.</span><span class="n">DispChar</span><span class="p">(</span><span class="n">say_hello</span><span class="p">(),</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">oled</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a script has been swiped on the device in addition to the MicroPython runtime, then MicroPython will ignore main.py and run your embedded script.</p>
<p>To refresh only the MicroPython runtime, just make sure that the script you write in the editor contains zero characters. Once flashed, you can copy the main.py file.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="timer.html" class="btn btn-neutral float-right" title="3. Timer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="random.html" class="btn btn-neutral float-left" title="1. Random Number" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, OHSTEM.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>